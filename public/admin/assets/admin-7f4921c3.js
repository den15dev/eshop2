const w=document.querySelector(".page-tint"),l=200,A=document.querySelector("html"),U=window.matchMedia("(min-width: 992px)"),ae=window.matchMedia("(min-width: 576px)"),le=document.querySelector('meta[name="csrf-token"]').content,D=document.documentElement.lang;let f;function M(e){return e.charAt(0).toUpperCase()+e.slice(1)}function de(){fetch("/admin/translations",{method:"get",headers:{Accept:"application/json"}}).then(e=>{if(!e.ok)throw new Error(`${e.status}`);return e.json()}).then(e=>{f=e}).catch(e=>{console.error("An error occurred while getting translations: "+e.message)})}function v(e,t,n){J(e)||ue(e,t,n)}function y(e,t,n){J(e)&&fe(e,t,n)}function H(e,t){t=`${t/1e3}s`,e.style.setProperty("--fade-speed",t)}function z(e){const t=getComputedStyle(e).getPropertyValue("opacity");e.style.setProperty("--max-opacity",t)}function J(e){return getComputedStyle(e).getPropertyValue("display")!=="none"}function ue(e,t,n){e.addEventListener("animationend",V,!1),H(e,t),z(e),e.style.display="block",e.classList.add("fade-in"),typeof n=="function"&&setTimeout(()=>n(),t+50)}function fe(e,t,n){e.addEventListener("animationend",K,!1),H(e,t),z(e),e.classList.add("fade-out"),typeof n=="function"&&setTimeout(()=>n(),t+50)}function V(e){e.target.classList.remove("fade-in"),e.target.removeEventListener("animationend",V,!1)}function K(e){e.target.classList.remove("fade-out"),e.target.style.display="none",e.target.removeEventListener("animationend",K,!1)}const X=100;let q=!1;function G(e){q&&L(),v(e.parentNode.querySelector(".dropdown-list"),X),e.dataset.opened="on",q=!0,document.addEventListener("click",Q)}function h(e){y(e.parentNode.querySelector(".dropdown-list"),X),e.dataset.opened="off",document.removeEventListener("click",Q)}function L(){document.querySelectorAll(".dropdown-btn").forEach(e=>{e.dataset.opened==="on"&&h(e)}),q=!1}function Q(e){q&&!e.target.closest(".dropdown-btn, .dropdown-list")&&L()}function pe(){document.querySelectorAll(".dropdown-btn").forEach(e=>{e.addEventListener("click",()=>{e.dataset.opened==="on"?L():G(e)})})}function ye(e){e.forEach(t=>{t.addEventListener("click",()=>{t.dataset.opened==="on"?L():G(t)})})}function me(){document.querySelectorAll(".local-menu").forEach(e=>{const t=e.dataset.type,n=t.charAt(0).toUpperCase()+t.slice(1),o=e.querySelector(".dropdown-btn");e.querySelectorAll(".dropdown-list div").forEach(s=>{s.dataset.isCurrent?s.addEventListener("click",()=>{h(o)}):s.addEventListener("click",()=>{const c=s.dataset.itemId,r=document.querySelector(`#change${n}Form`);r.querySelector(`[name="new_${t}"]`).value=c,r.submit()})})})}const I=document.querySelector(".modal-tint"),C=document.querySelector("#flashModal"),a=document.querySelector("#clientModal"),d=a.querySelector("#clientOkBtn"),b=a.querySelector("#clientCancelBtn");function he(){document.querySelectorAll(".modal-close-btn").forEach(t=>{t.addEventListener("click",()=>{const n=t.closest(".modal-win");E(n)})}),d&&d.addEventListener("click",()=>{E(a)}),b&&b.addEventListener("click",()=>{E(a)}),C&&be()}function E(e){y(e,l,()=>Se(e)),y(I,l)}function ge(e){W(e),v(I,l),v(e,l)}function be(){W(C),I.style.display="block",C.style.display="block";const e=document.querySelector("#flashOkBtn");e.addEventListener("click",()=>{const t=e.closest(".modal-win");E(t)})}function W(e){const t=e.parentNode;t.style.display="flex"}function Se(e){const t=e.parentNode;t.style.display="none"}function $(e={}){const t=a.querySelector(".modal-icon.info"),n=a.querySelector(".modal-icon.success"),o=a.querySelector(".modal-icon.warning"),s=a.querySelector(".modal-icon.confirm");if(e.message){const c=a.querySelector("p");c.innerHTML=e.message}e.type==="confirm"&&(b.style.display="block",e.okAction&&(d.addEventListener("click",e.okAction),d.addEventListener("click",()=>{d.removeEventListener("click",e.okAction)}),b.addEventListener("click",()=>{d.removeEventListener("click",e.okAction)}),d.closest(".modal-win").querySelector(".modal-close-btn").addEventListener("click",()=>{d.removeEventListener("click",e.okAction)})),e.cancelText&&(b.innerText=e.cancelText)),e.okText&&(d.innerText=e.okText),e.icon==="success"?n.style.display="block":e.icon==="warning"?o.style.display="block":e.icon==="confirm"?s.style.display="block":t.style.display="block",ge(a)}function Y(e){let t,n;switch(e.status){case 403:t=f.general.messages.forbidden,n="info";break;default:t=f.general.messages.error_occurred,n="warning";break}$({message:t,icon:n}),console.error(`${e.status} (${e.statusText})`)}const x=document.querySelector("ul.pagination");function ke(){x&&ae.addEventListener("change",ve)}function ve(e){e.matches?x.classList.remove("pagination-sm"):x.classList.add("pagination-sm")}let S;function we(e){S=e,S.forEach(t=>{var n;document.querySelector(t.container)&&(t.isOpened=!1,(Array.isArray(t.button)?t.button:[t.button]).forEach(s=>{var c;(c=document.querySelector(s))==null||c.addEventListener("click",function(){_(t)})}),(n=document.querySelector(t.container+" .bottom-menu_close-btn"))==null||n.addEventListener("click",function(){_(t)}))}),U.addEventListener("change",()=>{S.forEach(t=>{t.isOpened&&(O(t),y(w,l),Z())})})}function _(e){e.isOpened?(O(e),y(w,l),Z(),document.removeEventListener("click",j)):(S.forEach(t=>{t.isOpened&&(O(t),e.disablePageTint&&y(w,l))}),e.disablePageTint||v(w,l),v(document.querySelector(e.container),l),e.openActions(),e.isOpened=!0,Ee(),document.addEventListener("click",j))}function O(e){y(document.querySelector(e.container),l),e.closeActions(),e.isOpened=!1}function j(e){S.forEach(t=>{if(t.isOpened){let n=[t.container];Array.isArray(t.button)?t.button.forEach(s=>n.push(s)):n.push(t.button);let o=!1;n.forEach(s=>{!o&&e.target.closest(s)&&(o=!0)}),o||_(t)}})}function Ee(){!U.matches&&document.body.scrollHeight>window.innerHeight&&A.classList.add("noscroll-mobile")}function Z(){A.classList.remove("noscroll-mobile"),A.removeAttribute("class")}const qe=[{button:"#headerMobileLeftBtn",container:"#headerLeftMenuCont",openActions(){document.querySelector(this.button).classList.add("opened")},closeActions(){document.querySelector(this.button).classList.remove("opened")}},{button:"#headerMobileRightBtn",container:"#headerRightMenuCont",openActions(){document.querySelector(this.button).classList.add("opened")},closeActions(){document.querySelector(this.button).classList.remove("opened")}}];function Le(){we(qe)}const T=document.querySelector("#indexTableCont"),m=document.querySelector("#searchInput"),Ae=new URL(window.location.href),i=Ae.searchParams;let N,R,k;function Ce(){T&&(N=T.dataset.name,ee(),te(),ce(),ne()),m&&(m.addEventListener("input",xe),k=m.parentNode.querySelector(".index_search_close-btn"),k.addEventListener("click",()=>{_e(),k.classList.add("hidden")}))}function ee(){const t=document.querySelector(".index-table_pref-cont").querySelector(".column-selector"),n=t.dataset.cookieName,o=t.querySelector(".dropdown-btn"),s=t.querySelector(".column-selector_apply-btn"),c=t.querySelector(".column-selector_close-btn");s.addEventListener("click",()=>{const p=t.querySelector(".column-selector_list-cont").querySelectorAll(".column-selector_item input");let g=[];p.forEach(F=>{F.checked&&g.push(F.dataset.index)}),oe(n,g),u(),h(o)}),c.addEventListener("click",()=>{h(o)})}function te(){const e=document.querySelector(".index-table_per-page-dd");e.querySelectorAll(".dropdown-item").forEach(n=>{n.addEventListener("click",()=>{if(!n.classList.contains("active")){const s=parseInt(n.innerText,10);oe("tbl_perpage",s),i.delete("page"),u()}const o=e.querySelector(".dropdown-btn");h(o)})})}function ne(){document.querySelectorAll(".pagination a.page-link").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const o=new URL(t.href);i.set("page",o.searchParams.get("page")),u()})})}function xe(){clearTimeout(R);let e=m.value;i.delete("page"),e.length?(R=setTimeout(function(){i.set("search",e),u()},300),k.classList.remove("hidden")):(i.delete("search"),u(),k.classList.add("hidden"))}function _e(){m.value="",i.delete("search"),u(),m.focus()}function oe(e,t){document.cookie=e+"="+encodeURIComponent(JSON.stringify(t))+"; path=/; max-age=157680000"}function u(){fetch(`/${D}/admin/${N}/table?${i}`,{method:"get"}).then(e=>{if(!e.ok){const t=new Error;throw t.status=e.status,t.statusText=e.statusText,t}return e.text()}).then(e=>{T.innerHTML=e;const t=document.querySelectorAll(".column-selector .dropdown-btn, .index-table_per-page-dd .dropdown-btn");ye(t),ee(),te(),ce(),ne(),Oe()}).catch(e=>Y(e))}function Oe(){const e=new URL(window.location.href);e.search="",i.forEach((t,n)=>{e.searchParams.set(n,t)}),window.history.pushState(null,"",e.toString())}function ce(){document.querySelectorAll(".index-table_head-btn").forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.id,o=t.dataset.sortOrder;o==="desc"?(i.delete("sort"),i.delete("order")):o==="asc"?(i.set("sort",n),i.set("order","desc")):(i.set("sort",n),i.set("order","asc")),u()})})}function Te(){N==="products"&&(Be(),Me())}function Be(){const e=document.querySelector(".product-index_category select");e.addEventListener("change",()=>{e.value?i.set("category",e.value):i.has("category")&&i.delete("category"),i.delete("page"),u()})}function Me(){const e=document.querySelectorAll(".index_checkboxes input");e.forEach(t=>{t.addEventListener("change",()=>{let n=!0;e.forEach(o=>{o.checked||(n=!1)}),n?e.forEach(o=>i.delete(o.name)):e.forEach(o=>i.set(o.name,o.checked)),i.delete("page"),u()})})}function P(e,t,n,o=()=>{},s=()=>{}){fetch(`/${D}/admin/ajax`,{method:"post",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":le},body:JSON.stringify({service:e,action:t,args:n})}).then(c=>{if(!c.ok&&c.status!==422){const r=new Error;throw r.status=c.status,r.statusText=c.statusText,r}return c.json()}).then(c=>{c.errors?o(c):s(c)}).catch(c=>Y(c))}const Ie=document.querySelector(".product-edit_attribute-list"),B=document.querySelector("#changeCategoryBtn");function $e(){Ie&&document.querySelectorAll(".product-edit_attribute-item, .product-edit_variant-item").forEach(t=>{const n=t.querySelector(".product-edit_attribute_save-btn");n==null||n.addEventListener("click",()=>{Pe(t)});const o=t.querySelector(".product-edit_attribute_add-btn");o==null||o.addEventListener("click",()=>{Fe(t)});const s=t.querySelector(".product-edit_attribute_delete-btn");s==null||s.addEventListener("click",()=>{je(t)}),t.querySelector(".product-edit_attribute_close-btn").addEventListener("click",()=>{h(t.querySelector(".dropdown-btn"))})}),B&&Ne()}function Ne(){const e=B.closest("form"),n=document.querySelector("#productCategory").value;B.addEventListener("click",o=>{o.preventDefault(),document.querySelector("#productCategory").value!==n&&$({type:"confirm",icon:"warning",message:f.messages.products.change_category,okAction:function(){e.submit()},okText:f.messages.buttons.move})})}function Pe(e){const t=e.dataset.type,n="update"+M(t),o=e.dataset.id,s=se(e);P("product",n,{id:o,fields:s},function(r){for(const p in r.errors){const g=ie(e,p);g&&re(g,r.errors[p][0])}},function(){window.location.reload()})}function Fe(e){const t=e.dataset.type,n="create"+M(t),s={fields:se(e)};switch(t){case"attribute":s.product_id=e.dataset.product;break;case"variant":s.attribute_id=e.dataset.attribute;break}P("product",n,s,function(c){for(const r in c.errors){const p=ie(e,r);p&&re(p,c.errors[r][0])}},function(){window.location.reload()})}function je(e){const t=e.dataset.type;let n;switch(t){case"attribute":n=f.messages.products.delete_attribute;break;case"variant":n=f.messages.products.delete_variant;break}$({type:"confirm",icon:"warning",message:n,okAction:function(){const o="delete"+M(t),c={id:e.dataset.id};P("product",o,c,()=>{},function(){window.location.reload()})},okText:f.messages.buttons.delete})}function se(e){const t={};return e.querySelectorAll(".product-edit_attribute_input-cont").forEach(o=>{const s=o.dataset.lang,c=o.querySelector("input");c.value&&(t[s]=c.value)}),t}function ie(e,t){let n;const o=t.split(".").pop();return e.querySelectorAll(".product-edit_attribute_input-cont").forEach(c=>{c.dataset.lang===o&&(n=c.querySelector("input"))}),n}function re(e,t){e.classList.add("is-invalid"),e.parentNode.querySelector(".invalid-feedback").innerText=t}pe();he();ke();Ce();me();Le();Te();$e();de();
